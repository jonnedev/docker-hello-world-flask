trigger:
- main

pool:
  vmImage: ubuntu-latest

stages:
- stage: BuildApp 
  jobs:
    - job: BuildPushImage
      steps: 
      - task: Docker@2
        inputs:
          containerRegistry: 'ACR'
          repository: 'acrdev001jsb.azurecr.io'
          command: 'buildAndPush'
          Dockerfile: '**/Dockerfile'
          tags: '$(Build.BuildId)'

- stage: ScanImage
  jobs:
    - job: ScanImage
      steps:
      - task: AzureCLI@2
        inputs:
          azureSubscription: 'ADO'
          scriptType: 'pscore'
          scriptLocation: 'scriptPath'
          scriptPath: '$(Build.SourcesDirectory)/.scripts/ImageScanSummaryAssessmentGate.ps1'
          arguments: '-registryName acrdev001jsb -repository acrdev001jsb.azurecr.io -tag $(Build.BuildId)'